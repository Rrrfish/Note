# 容器存储管理

## 容器持久化管理

### 数据卷挂载

容器销毁之后，其内部所有后期加入的数据都会消失，解决办法就是使用 **数据卷**（**Data Volume**）。

示例

```shell
$ docker run -it -v ~/test:/root/test centos-net
```

`-v`用于指定文件挂载，`:`前的为宿主机目录，`:`后为容器目录。

之后在容器内部就会看到一个相同的目录，目录内容与宿主机一致，修改目录内数据也会改变宿主机数据，即使容器销毁，挂载的文件也会保留，进而实现容器持久化。

如果在创建容器时**没有指定宿主机目录**，只指明了挂载路径，那么就由Docker来自动创建一个目录，并且会将容器中对应路径下的内容拷贝到这个自动创建的目录中，最后挂在到容器中，这种就是由Docker管理的数据卷了（docker managed volume）。可以用`docker volume ls`和`docker volume inspect`来查看具体路径。

```shell
$ docker volume ls
DRIVER    VOLUME NAME
local     recalldapr_recall-sqldata
$ docker volume inspect recalldapr_recall-sqldata 
[
    {
        "CreatedAt": "2024-04-25T19:56:12+08:00",
        "Driver": "local",
        "Labels": {
            "com.docker.compose.project": "recalldapr",
            "com.docker.compose.version": "2.27.0",
            "com.docker.compose.volume": "recall-sqldata"
        },
        "Mountpoint": "/var/lib/docker/volumes/recalldapr_recall-sqldata/_data",
        "Name": "recalldapr_recall-sqldata",
        "Options": null,
        "Scope": "local"
    }
]
```

docker管理的数据卷也可以我们自己进行创建

```shell
$ docker volume create good_volume
good_volume
$ docker volume inspect good_volume 
[
    {
        "CreatedAt": "2024-06-18T14:25:09+08:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/good_volume/_data",
        "Name": "good_volume",
        "Options": null,
        "Scope": "local"
    }
]
```



### 文件传输（宿主机 -> 容器）

可以用`cp`命令将宿主机文件传输到容器内部，例

```shell
$ docker cp ~/test/hello.txt test1:/root
Successfully copied 2.05kB to test1:/root
```



### 容器数据共享

**方法一**，让容器们挂载宿主机同一个目录。

**方法二**，使用数据卷容器。

```shell
docker run -it --volumes-from test_docker centos-volume
```

这样，`--volumes-from`后的容器内挂载的目录也会挂载到这个新容器上，这里`test_docker`很多时候又可以叫做**数据卷容器**，它一般专门用于提供数据卷。此时如果`test_docker`被销毁，`centos-volume`中挂载的目录也不会被影响。

**方法三**，使用`Dockerfile`。

```dockerfile
FROM ubuntu
ADD moban5676.tar.gz /usr/share/nginx/html/
VOLUME /usr/share/nginx/html/
```

`ADD`指令会将宿主机对应的文件传入容器并解压，`COPY`指令只传送不解压。`VOLUME`指令和docker的`-v`差不多，会在容器挂载一个数据卷。